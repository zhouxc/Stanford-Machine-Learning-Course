CS229 Lecture notes
Andrew Ng

Mixtures of Gaussians and the EM algorithm
In this set of notes, we discuss the EM (Expectation-Maximization) for density estimation.
Suppose that we are given a training set {x(1) , . . . , x(m) } as usual. Since
we are in the unsupervised learning setting, these points do not come with
any labels.
We wish to model the data by specifying a joint distribution p(x(i) , z (i) ) =
(i) (i)
p(x |z )p(z (i) ). Here, z (i) ∼ Multinomial(φ) (where φj ≥ 0, kj=1 φj = 1,
and the parameter φj gives p(z (i) = j),), and x(i) |z (i) = j ∼ N (µj , Σj ). We
let k denote the number of values that the z (i) ’s can take on. Thus, our
model posits that each x(i) was generated by randomly choosing z (i) from
{1, . . . , k}, and then x(i) was drawn from one of k Gaussians depeneding on
z (i) . This is called the mixture of Gaussians model. Also, note that the
z (i) ’s are latent random variables, meaning that they’re hidden/unobserved.
This is what will make our estimation problem difficult.
The parameters of our model are thus φ, φ and Σ. To estimate them, we
can write down the likelihood of our data:
m

log p(x(i) ; φ, µ, Σ)

ℓ(φ, µ, Σ) =
i=1
m

=

k

p(x(i) |z (i) ; µ, Σ)p(z (i) ; φ).

log
i=1

z (i) =1

However, if we set to zero the derivatives of this formula with respect to
the parameters and try to solve, we’ll find that it is not possible to find the
maximum likelihood estimates of the parameters in closed form. (Try this
yourself at home.)
The random variables z (i) indicate which of the k Gaussians each x(i)
had come from. Note that if we knew what the z (i) ’s were, the maximum
1

2
likelihood problem would have been easy. Specifically, we could then write
down the likelihood as
m

log p(x(i) |z (i) ; µ, Σ) + log p(z (i) ; φ).

ℓ(φ, µ, Σ) =
i=1

Maximizing this with respect to φ, µ and Σ gives the parameters:
φj =
µj =
Σj =

1
m

m

1{z (i) = j},
i=1
m
(i)
= j}x(i)
i=1 1{z
,
m
(i) = j}
i=1 1{z
m
(i)
= j}(x(i) − µj )(x(i)
i=1 1{z
m
(i) = j}
i=1 1{z

− µj )T

.

Indeed, we see that if the z (i) ’s were known, then maximum likelihood
estimation becomes nearly identical to what we had when estimating the
parameters of the Gaussian discriminant analysis model, except that here
the z (i) ’s playing the role of the class labels.1
However, in our density estimation problem, the z (i) ’s are not known.
What can we do?
The EM algorithm is an iterative algorithm that has two main steps.
Applied to our problem, in the E-step, it tries to “guess” the values of the
z (i) ’s. In the M-step, it updates the parameters of our model based on our
guesses. Since in the M-step we are pretending that the guesses in the first
part were correct, the maximization becomes easy. Here’s the algorithm:
Repeat until convergence: {
(E-step) For each i, j, set
(i)

wj := p(z (i) = j|x(i) ; φ, µ, Σ)
1

There are other minor differences in the formulas here from what we’d obtained in
PS1 with Gaussian discriminant analysis, first because we’ve generalized the z (i) ’s to be
multinomial rather than Bernoulli, and second because here we are using a different Σj
for each Gaussian.

3
(M-step) Update the parameters:
φj

1
:=
m

µj :=
Σj :=

m
(i)

wj ,
i=1
(i) (i)
m
i=1 wj x
,
(i)
m
i=1 wj
(i) (i)
m
− µj )(x(i)
i=1 wj (x
(i)
m
i=1 wj

− µj )T

}
In the E-step, we calculate the posterior probability of our parameters
the z (i) ’s, given the x(i) and using the current setting of our parameters. I.e.,
using Bayes rule, we obtain:
p(z (i) = j|x(i) ; φ, µ, Σ) =

p(x(i) |z (i) = j; µ, Σ)p(z (i) = j; φ)
k
l=1

p(x(i) |z (i) = l; µ, Σ)p(z (i) = l; φ)

Here, p(x(i) |z (i) = j; µ, Σ) is given by evaluating the density of a Gaussian
with mean µj and covariance Σj at x(i) ; p(z (i) = j; φ) is given by φj , and so
(i)
on. The values wj calculated in the E-step represent our “soft” guesses2 for
the values of z (i) .
Also, you should contrast the updates in the M-step with the formulas we
had when the z (i) ’s were known exactly. They are identical, except that instead of the indicator functions “1{z (i) = j}” indicating from which Gaussian
(i)
each datapoint had come, we now instead have the wj ’s.
The EM-algorithm is also reminiscent of the K-means clustering algorithm, except that instead of the “hard” cluster assignments c(i), we instead
(i)
have the “soft” assignments wj . Similar to K-means, it is also susceptible
to local optima, so reinitializing at several different initial parameters may
be a good idea.
It’s clear that the EM algorithm has a very natural interpretation of
repeatedly trying to guess the unknown z (i) ’s; but how did it come about,
and can we make any guarantees about it, such as regarding its convergence?
In the next set of notes, we will describe a more general view of EM, one
2

The term “soft” refers to our guesses being probabilities and taking values in [0, 1]; in
contrast, a “hard” guess is one that represents a single best guess (such as taking values
in {0, 1} or {1, . . . , k}).

4
that will allow us to easily apply it to other estimation problems in which
there are also latent variables, and which will allow us to give a convergence
guarantee.

